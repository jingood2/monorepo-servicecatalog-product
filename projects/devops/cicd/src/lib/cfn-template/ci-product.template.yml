{
  "Metadata": {
    "AWS::CloudFormation::Interface": {
      "ParameterGroups": [
        {
          "Label": {
            "default": "Git Repository Common Information"
          },
          "Parameters": [
            "SourceProviderType",
            "RepoName",
            "RepoBranch"
          ]
        },
        {
          "Label": {
            "default": "GitHub Information"
          },
          "Parameters": [
            "RepoOwner",
            "GithubSecretTokenId"
          ]
        },
        {
          "Label": {
            "default": "Configuration for Architect"
          },
          "Parameters": [
            "ServiceName",
            "PackagingType",
          ]
        }
      ]
    }
  },
  "Parameters": {
    "ServiceName": {
      "Type": "String",
      "Default": "hello-app",
      "Description": "Service Name"
    },
    "RepoName": {
      "Type": "String",
      "Description": "Git Repository or S3 Bucket Name"
    },
    "RepoOwner": {
      "Type": "String",
      "Default": "namespace",
      "Description": "(Github Only Use) Github Owner"
    },
    "RepoBranch": {
      "Type": "String",
      "Default": "master",
      "Description": "Git Repository Branch name"
    },
    "GithubSecretTokenId": {
      "Type": "String",
      "Default": "NA",
      "Description": "(Github Only Use) AWS Secret Key for Github Personal Token"
    },
    "SourceProviderType": {
      "Type": "String",
      "Default": "GITHUB",
      "AllowedValues": [
        "GITHUB",
        "CODECOMMIT",
        "S3"
      ],
      "Description": "Source Provider Type"
    },
    "PackagingType": {
      "Type": "String",
      "Default": "GRADLE",
      "AllowedValues": [
        "MAVEN",
        "GRADLE",
        "NPM",
        "PYTHON",
        "DOCKER"
      ],
      "Description": "Source Packaging Tool"
    }
  },
  "Conditions": {
    "IsGithubCondition": {
      "Fn::Equals": [
        "GITHUB",
        {
          "Ref": "SourceProviderType"
        }
      ]
    },
    "IsCodecommitCondition": {
      "Fn::Equals": [
        "CODECOMMIT",
        {
          "Ref": "SourceProviderType"
        }
      ]
    },
  },
  "Resources": {
    "ECRRepositoryF3A3832E": {
      "Type": "AWS::ECR::Repository",
      "Properties": {
        "ImageScanningConfiguration": {
          "ScanOnPush": true
        },
        "RepositoryName": {
          "Ref": "ServiceName"
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
    },
    "S3BucketsAppD2AFB953": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketName": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "ServiceName"
              },
              "-codepipeline-artifact"
            ]
          ]
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
    },
    "CIBuildProjectRoleD5A05FCB": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "codebuild.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
    },
    "CIBuildProjectRoleDefaultPolicyDF888A2D": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":logs:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":log-group:/aws/codebuild/",
                      {
                        "Ref": "CIBuildProject1FB2A101"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":logs:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":log-group:/aws/codebuild/",
                      {
                        "Ref": "CIBuildProject1FB2A101"
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "codebuild:CreateReportGroup",
                "codebuild:CreateReport",
                "codebuild:UpdateReport",
                "codebuild:BatchPutTestCases",
                "codebuild:BatchPutCodeCoverages"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":codebuild:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":report-group/",
                    {
                      "Ref": "CIBuildProject1FB2A101"
                    },
                    "-*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ECRRepositoryF3A3832E",
                  "Arn"
                ]
              }
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "ecr:PutImage",
                "ecr:InitiateLayerUpload",
                "ecr:UploadLayerPart",
                "ecr:CompleteLayerUpload"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ECRRepositoryF3A3832E",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "S3BucketsAppD2AFB953",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "S3BucketsAppD2AFB953",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CIBuildProjectRoleDefaultPolicyDF888A2D",
        "Roles": [
          {
            "Ref": "CIBuildProjectRoleD5A05FCB"
          }
        ]
      },
    },
    "CIBuildProject1FB2A101": {
      "Type": "AWS::CodeBuild::Project",
      "Properties": {
        "Artifacts": {
          "Type": "CODEPIPELINE"
        },
        "Environment": {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "EnvironmentVariables": [
            {
              "Name": "ECR_REPOSITORY_URI",
              "Type": "PLAINTEXT",
              "Value": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::Select": [
                        4,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "ECRRepositoryF3A3832E",
                                "Arn"
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    ".dkr.ecr.",
                    {
                      "Fn::Select": [
                        3,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "ECRRepositoryF3A3832E",
                                "Arn"
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    ".",
                    {
                      "Ref": "AWS::URLSuffix"
                    },
                    "/",
                    {
                      "Ref": "ECRRepositoryF3A3832E"
                    }
                  ]
                ]
              }
            },
            {
              "Name": "AWS_DEFAULT_REGION",
              "Type": "PLAINTEXT",
              "Value": {
                "Ref": "AWS::Region"
              }
            },
            {
              "Name": "AWS_ACCOUNT_ID",
              "Type": "PLAINTEXT",
              "Value": {
                "Ref": "AWS::AccountId"
              }
            },
            {
              "Name": "BUILD_TYPE",
              "Type": "PLAINTEXT",
              "Value": {
                "Ref": "PackagingType"
              }
            }
          ],
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": true,
          "Type": "LINUX_CONTAINER"
        },
        "ServiceRole": {
          "Fn::GetAtt": [
            "CIBuildProjectRoleD5A05FCB",
            "Arn"
          ]
        },
        "Source": {
          "BuildSpec": "{\n  \"version\": 0.2,\n  \"env\": {\n    \"exported-variables\": [\n      \"IMAGE_TAG\"\n    ]\n  },\n  \"phases\": {\n    \"pre_build\": {\n      \"commands\": [\n        \"echo Logging in to Amazon ECR...\",\n        \"echo $ECR_REPOSITORY_URI\",\n        \"echo $AWS_DEFAULT_REGION\",\n        \"echo $CODEBUILD_RESOLVED_SOURCE_VERSION\",\n        \"echo $CODEBUILD_SOURCE_VERSION\",\n        \"echo $AWS_ACCOUNT_ID\",\n        \"echo $BUILD_TYPE\",\n        \"aws --version\",\n        \"aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin $(aws sts get-caller-identity --query Account --output text).dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com\",\n        \"COMMIT_HASH=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)\",\n        \"export IMAGE_TAG=${COMMIT_HASH:=latest}\"\n      ]\n    },\n    \"build\": {\n      \"commands\": [\n        \"echo Build started on `date`\",\n        \"echo $BUILD_TYPE\",\n        \"if [ \\\"$BUILD_TYPE\\\" = \\\"GRADLE\\\" ]; then \\n  chmod +x gradlew ;\\n  ./gradlew clean build ;\\nfi\\n\",\n        \"if [ \\\"$BUILD_TYPE\\\" = \\\"MAVEN\\\" ]; then \\n  +x mvnw;\\n  ./mvnw clean package ;\\nfi\\n\",\n        \"if [ \\\"$BUILD_TYPE\\\" = \\\"NPM\\\" ]; then \\n  npm install ;\\nfi\\n\",\n        \"if [ \\\"$BUILD_TYPE\\\" = \\\"DOCKER\\\" ]; then \\n  echo Building the Docker image...\\n  docker build -t $ECR_REPOSITORY_URI:$IMAGE_TAG .\\n  echo Tagging Docker image...\\n  docker tag $ECR_REPOSITORY_URI:$IMAGE_TAG $ECR_REPOSITORY_URI:latest\\nfi\\n\"\n      ]\n    },\n    \"post_build\": {\n      \"commands\": [\n        \"echo Build completed on `date`\",\n        \"echo Pushing the Docker images...\",\n        \"docker push $ECR_REPOSITORY_URI:latest\",\n        \"docker push $ECR_REPOSITORY_URI:$IMAGE_TAG\"\n      ]\n    }\n  }\n}",
          "Type": "CODEPIPELINE"
        },
        "Cache": {
          "Modes": [
            "LOCAL_DOCKER_LAYER_CACHE"
          ],
          "Type": "LOCAL"
        },
        "EncryptionKey": "alias/aws/s3"
      },
    },
    "GitRepositorycdkservicecatalogproductsCICodeCommitPipelineB1C7185B0EventRuleE561F216": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "EventPattern": {
          "source": [
            "aws.codecommit"
          ],
          "resources": [
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition"
                  },
                  ":codecommit:",
                  {
                    "Ref": "AWS::Region"
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId"
                  },
                  ":",
                  {
                    "Ref": "RepoName"
                  }
                ]
              ]
            }
          ],
          "detail-type": [
            "CodeCommit Repository State Change"
          ],
          "detail": {
            "event": [
              "referenceCreated",
              "referenceUpdated"
            ],
            "referenceName": [
              {
                "Ref": "RepoBranch"
              }
            ]
          }
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition"
                  },
                  ":codepipeline:",
                  {
                    "Ref": "AWS::Region"
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId"
                  },
                  ":",
                  {
                    "Ref": "CodeCommitPipeline2208527B"
                  }
                ]
              ]
            },
            "Id": "Target0",
            "RoleArn": {
              "Fn::GetAtt": [
                "CodeCommitPipelineEventsRole4B95064C",
                "Arn"
              ]
            }
          }
        ]
      },
      "Condition": "IsCodecommitCondition"
    },
    "GitHubPipelineRoleB9AFBEB2": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "codepipeline.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
    },
    "GitHubPipelineRoleDefaultPolicyDC5A4395": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "S3BucketsAppD2AFB953",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "S3BucketsAppD2AFB953",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "GitHubPipelineBuildBuildAndPushOnECRCodePipelineActionRole73F3BA38",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "GitHubPipelineRoleDefaultPolicyDC5A4395",
        "Roles": [
          {
            "Ref": "GitHubPipelineRoleB9AFBEB2"
          }
        ]
      },
    },
    "GitHubPipeline7B79E906": {
      "Type": "AWS::CodePipeline::Pipeline",
      "Properties": {
        "RoleArn": {
          "Fn::GetAtt": [
            "GitHubPipelineRoleB9AFBEB2",
            "Arn"
          ]
        },
        "Stages": [
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Source",
                  "Owner": "ThirdParty",
                  "Provider": "GitHub",
                  "Version": "1"
                },
                "Configuration": {
                  "Owner": {
                    "Ref": "RepoOwner"
                  },
                  "Repo": {
                    "Ref": "RepoName"
                  },
                  "Branch": {
                    "Ref": "RepoBranch"
                  },
                  "OAuthToken": {
                    "Fn::Join": [
                      "",
                      [
                        "{{resolve:secretsmanager:",
                        {
                          "Ref": "GithubSecretTokenId"
                        },
                        ":SecretString:::}}"
                      ]
                    ]
                  },
                  "PollForSourceChanges": false
                },
                "Name": "GITHUB",
                "OutputArtifacts": [
                  {
                    "Name": "Source"
                  }
                ],
                "RunOrder": 1
              }
            ],
            "Name": "Source"
          },
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1"
                },
                "Configuration": {
                  "ProjectName": {
                    "Ref": "CIBuildProject1FB2A101"
                  }
                },
                "InputArtifacts": [
                  {
                    "Name": "Source"
                  }
                ],
                "Name": "BuildAndPushOnECR",
                "OutputArtifacts": [
                  {
                    "Name": "Build"
                  }
                ],
                "RoleArn": {
                  "Fn::GetAtt": [
                    "GitHubPipelineBuildBuildAndPushOnECRCodePipelineActionRole73F3BA38",
                    "Arn"
                  ]
                },
                "RunOrder": 1
              }
            ],
            "Name": "Build"
          }
        ],
        "ArtifactStore": {
          "Location": {
            "Ref": "S3BucketsAppD2AFB953"
          },
          "Type": "S3"
        },
        "Name": {
          "Fn::Join": [
            "",
            [
              "github-",
              {
                "Ref": "ServiceName"
              },
              "-ci"
            ]
          ]
        }
      },
      "DependsOn": [
        "GitHubPipelineRoleDefaultPolicyDC5A4395",
        "GitHubPipelineRoleB9AFBEB2"
      ],
      "Condition": "IsGithubCondition"
    },
    "GitHubPipelineBuildBuildAndPushOnECRCodePipelineActionRole73F3BA38": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":iam::",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":root"
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
    },
    "GitHubPipelineBuildBuildAndPushOnECRCodePipelineActionRoleDefaultPolicy88D8F9CF": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "CIBuildProject1FB2A101",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "GitHubPipelineBuildBuildAndPushOnECRCodePipelineActionRoleDefaultPolicy88D8F9CF",
        "Roles": [
          {
            "Ref": "GitHubPipelineBuildBuildAndPushOnECRCodePipelineActionRole73F3BA38"
          }
        ]
      },
    },
    "CfnGitHubWebhook": {
      "Type": "AWS::CodePipeline::Webhook",
      "Properties": {
        "Authentication": "GITHUB_HMAC",
        "AuthenticationConfiguration": {
          "SecretToken": {
            "Fn::Join": [
              "",
              [
                "{{resolve:secretsmanager:arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":secretsmanager:",
                {
                  "Ref": "AWS::Region"
                },
                ":",
                {
                  "Ref": "AWS::AccountId"
                },
                ":secret:",
                {
                  "Ref": "GithubSecretTokenId"
                },
                ":SecretString:::}}"
              ]
            ]
          }
        },
        "Filters": [
          {
            "JsonPath": "$.ref",
            "MatchEquals": "refs/heads/{Branch}"
          }
        ],
        "TargetAction": "GITHUB",
        "TargetPipeline": {
          "Ref": "GitHubPipeline7B79E906"
        },
        "TargetPipelineVersion": 1,
        "RegisterWithThirdParty": true
      },
      "Condition": "IsGithubCondition"
    },
    "CodeCommitPipelineRole030CEFF9": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "codepipeline.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
    },
    "CodeCommitPipelineRoleDefaultPolicy9DE81801": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "S3BucketsAppD2AFB953",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "S3BucketsAppD2AFB953",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "CodeCommitPipelineSourceCODECOMMITCodePipelineActionRole39EEF435",
                  "Arn"
                ]
              }
            },
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "CodeCommitPipelineBuildBuildAndPushOnECRCodePipelineActionRole8E2095E3",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CodeCommitPipelineRoleDefaultPolicy9DE81801",
        "Roles": [
          {
            "Ref": "CodeCommitPipelineRole030CEFF9"
          }
        ]
      },
    },
    "CodeCommitPipeline2208527B": {
      "Type": "AWS::CodePipeline::Pipeline",
      "Properties": {
        "RoleArn": {
          "Fn::GetAtt": [
            "CodeCommitPipelineRole030CEFF9",
            "Arn"
          ]
        },
        "Stages": [
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Source",
                  "Owner": "AWS",
                  "Provider": "CodeCommit",
                  "Version": "1"
                },
                "Configuration": {
                  "RepositoryName": {
                    "Ref": "RepoName"
                  },
                  "BranchName": {
                    "Ref": "RepoBranch"
                  },
                  "PollForSourceChanges": false
                },
                "Name": "CODECOMMIT",
                "OutputArtifacts": [
                  {
                    "Name": "Source"
                  }
                ],
                "RoleArn": {
                  "Fn::GetAtt": [
                    "CodeCommitPipelineSourceCODECOMMITCodePipelineActionRole39EEF435",
                    "Arn"
                  ]
                },
                "RunOrder": 1
              }
            ],
            "Name": "Source"
          },
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1"
                },
                "Configuration": {
                  "ProjectName": {
                    "Ref": "CIBuildProject1FB2A101"
                  }
                },
                "InputArtifacts": [
                  {
                    "Name": "Source"
                  }
                ],
                "Name": "BuildAndPushOnECR",
                "OutputArtifacts": [
                  {
                    "Name": "Build"
                  }
                ],
                "RoleArn": {
                  "Fn::GetAtt": [
                    "CodeCommitPipelineBuildBuildAndPushOnECRCodePipelineActionRole8E2095E3",
                    "Arn"
                  ]
                },
                "RunOrder": 1
              }
            ],
            "Name": "Build"
          }
        ],
        "ArtifactStore": {
          "Location": {
            "Ref": "S3BucketsAppD2AFB953"
          },
          "Type": "S3"
        },
        "Name": {
          "Fn::Join": [
            "",
            [
              "codecommit-",
              {
                "Ref": "ServiceName"
              },
              "-ci"
            ]
          ]
        }
      },
      "DependsOn": [
        "CodeCommitPipelineRoleDefaultPolicy9DE81801",
        "CodeCommitPipelineRole030CEFF9"
      ],
      "Condition": "IsCodecommitCondition"
    },
    "CodeCommitPipelineSourceCODECOMMITCodePipelineActionRole39EEF435": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":iam::",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":root"
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
    },
    "CodeCommitPipelineSourceCODECOMMITCodePipelineActionRoleDefaultPolicyB1A3EEEA": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "S3BucketsAppD2AFB953",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "S3BucketsAppD2AFB953",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "codecommit:GetBranch",
                "codecommit:GetCommit",
                "codecommit:UploadArchive",
                "codecommit:GetUploadArchiveStatus",
                "codecommit:CancelUploadArchive"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":codecommit:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":",
                    {
                      "Ref": "RepoName"
                    }
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CodeCommitPipelineSourceCODECOMMITCodePipelineActionRoleDefaultPolicyB1A3EEEA",
        "Roles": [
          {
            "Ref": "CodeCommitPipelineSourceCODECOMMITCodePipelineActionRole39EEF435"
          }
        ]
      },
    },
    "CodeCommitPipelineEventsRole4B95064C": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
    },
    "CodeCommitPipelineEventsRoleDefaultPolicyE6B9309F": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "codepipeline:StartPipelineExecution",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":codepipeline:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":",
                    {
                      "Ref": "CodeCommitPipeline2208527B"
                    }
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CodeCommitPipelineEventsRoleDefaultPolicyE6B9309F",
        "Roles": [
          {
            "Ref": "CodeCommitPipelineEventsRole4B95064C"
          }
        ]
      },
    },
    "CodeCommitPipelineBuildBuildAndPushOnECRCodePipelineActionRole8E2095E3": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":iam::",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":root"
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
    },
    "CodeCommitPipelineBuildBuildAndPushOnECRCodePipelineActionRoleDefaultPolicy86EDDDA8": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "CIBuildProject1FB2A101",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CodeCommitPipelineBuildBuildAndPushOnECRCodePipelineActionRoleDefaultPolicy86EDDDA8",
        "Roles": [
          {
            "Ref": "CodeCommitPipelineBuildBuildAndPushOnECRCodePipelineActionRole8E2095E3"
          }
        ]
      },
    },
  }
}